
<div class="loader" ng-if="!currentRoom">
  <md-progress-circular class="md-hue-2 md-warn" md-mode="indeterminate"></md-progress-circular>
</div>
<div flex layout="row" class="chat-container" ng-show="currentRoom">

  <md-sidenav
    md-is-locked-open="$mdMedia('gt-md')"
    class="md-whiteframe-z1"
    md-component-id="left">

    <md-toolbar class="md-hue-2">
      <div class="md-toolbar-tools">
        <h3>

          <battery-level style="fill: #fff; position: relative; top: 4px;"></battery-level>
          Time: <clock format="HH:mm"></clock>

        </h3>
      </div>
    </md-toolbar>

    <md-content flex role="navigation" md-scroll-y>

      <md-input-container flex ng-if="rooms.length > 3">
        <label>Search rooms</label>
        <input placeholder="Search rooms" ng-model="$parent.roomSearch.name" type="search">
      </md-input-container>

      <md-button
        ng-click="toggleLeft()"
        class="md-primary"
        hide-gt-sm>
        Toggle left
      </md-button>

      <md-list>
        <md-item
          ng-repeat="room in rooms | filter:roomSearch"
          ng-click="setActiveRoom(room)">
          <md-item-content
            class="select-room"
            ng-class="{selected: room.$selected}">

            <div class="md-tile-left">
              <img ng-src="{{room.icon}}" class="face" alt="{{room.name}}" title="{{room.name}}">
            </div>
            <div class="md-tile-content">
              <h3>{{room.name}} <span ng-if="room.messages" class="badge">{{room.messages}}</span></h3>
            </div>
          </md-item-content>
        </md-item>
      </md-list>


      <!-- // refactor to room directive
      <md-content class="md-padding">
        <form ng-submit="createRoom()">
          <md-input-container flex>
            <label>Room name</label>
            <input placeholder="Room name" ng-model="roomName">
          </md-input-container>

          <md-button class="md-primary md-raised" type="submit">Create room</md-button>
        </form>
      </md-content> -->

    </md-content>

  </md-sidenav>

  <div layout="column" role="main" flex class="messages-container">
    <md-toolbar class="md-default-theme" layout="row">
      <md-button class="menu" hide-gt-md ng-click="toggleLeft()" aria-label="Show User List">
        <ng-md-icon icon="menu" style="fill: white"></ng-md-icon>
      </md-button>

      <div class="md-toolbar-tools">
        <h3>
          <span>Chat: {{currentRoom.name}}</span>
        </h3>

        <div class="md-toolbar-item md-tools" layout="column" layout-gt-md="row">
          <small>Online: <online-count></online-count></small>
        </div>

      </div>
    </md-toolbar>
    <md-content flex scroll-glue class="md-whiteframe-z1 md-padding" id="content" md-scroll-y>
      <messages room="currentRoom" chat-id="chat_id" scroll-glue ng-if="currentRoom"></messages>

      <div class="typing-container">
        <small ng-if="peopleTyping.length">
          <span ng-repeat="person in peopleTyping">
            {{person}}<span ng-if="!$last">,</span>
          </span>
          <span ng-if="peopleTyping.length == 1">is</span>
          <span ng-if="peopleTyping.length > 1">are</span>
          typing..
        </small>
      </div>

    </md-content>
  </div>
</div>

<div flex class="send-message-container" ng-show="currentRoom">
  <form ng-submit="saveMessage()">
    <md-content flex layout="row" class="md-whiteframe-z1 md-padding">
      <md-input-container flex="15">
        <label>Your name</label>
        <input placeholder="Your message" ng-model="from" ng-change="setUsername()">
      </md-input-container>
      <md-input-container flex>
        <label>Your message</label>
        <input placeholder="Your message" ng-model="message" ng-change="i_am_typing()">
      </md-input-container>

      <md-button md-no-ink class="md-primary" type="submit">Send</md-button>
    </md-content>
  </form>
</div>
